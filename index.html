<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Portfolio Data</title>
    
    <!-- 1. Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        #error-console { display: none; background: #fee2e2; color: #991b1b; padding: 20px; border: 2px solid #ef4444; margin: 20px; border-radius: 8px; font-family: monospace; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #0f766e; border-radius: 4px; }
        .text-pretty { white-space: pre-wrap; }
    </style>

    <!-- 2. React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 3. Firebase (Seulement App, Auth et Firestore - Pas de Storage) -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-slate-900 text-slate-200">

    <div id="error-console"></div>
    <div id="root"></div>

    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            const errorBox = document.getElementById('error-console');
            errorBox.style.display = 'block';
            errorBox.innerHTML = `<strong>Oups ! Une erreur est survenue :</strong><br>${message}<br><small>Ligne: ${lineno}</small>`;
            console.error(error);
        };
    </script>

    <script type="text/babel">
        
        const firebaseConfig = {
            apiKey: "AIzaSyANMQfdMyhkbfMCjrJXR4c8zLCfuhHo8sc",
            authDomain: "portfolio-c286b.firebaseapp.com",
            projectId: "portfolio-c286b",
            storageBucket: "portfolio-c286b.firebasestorage.app",
            messagingSenderId: "960276980758",
            appId: "1:960276980758:web:89ead44211ab21e1fac137",
            measurementId: "G-8RXHMR52N7"
        };

        // --- Initialisation Firebase ---
        let app, auth, db;
        try {
            if (firebaseConfig.apiKey === "REMPLACE_CETTE_ZONE_PAR_TA_CLE") {
                throw new Error("Configuration Firebase manquante !");
            }
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            // Plus besoin de storage ici
        } catch (e) {
            console.warn(e);
            if(e.message.includes("manquante")) {
                 document.getElementById('error-console').style.display = 'block';
                 document.getElementById('error-console').innerHTML = e.message;
            }
        }

        const { useState, useEffect } = React;
        
        // --- ICÔNES ---
        const IconSVG = ({ children, size = 24, className, onClick }) => (
            <svg onClick={onClick} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );
        const Icons = {
            User: (p) => <IconSVG {...p}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconSVG>,
            Code: (p) => <IconSVG {...p}><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></IconSVG>,
            Briefcase: (p) => <IconSVG {...p}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></IconSVG>,
            Plus: (p) => <IconSVG {...p}><path d="M5 12h14"/><path d="M12 5v14"/></IconSVG>,
            Trash2: (p) => <IconSVG {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconSVG>,
            Lock: (p) => <IconSVG {...p}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></IconSVG>,
            Unlock: (p) => <IconSVG {...p}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></IconSVG>,
            X: (p) => <IconSVG {...p}><path d="M18 6 6 18"/><path d="m6 6 18 12"/></IconSVG>,
            Database: (p) => <IconSVG {...p}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></IconSVG>,
            ChevronUp: (p) => <IconSVG {...p}><polyline points="18 15 12 9 6 15"/></IconSVG>,
            ChevronDown: (p) => <IconSVG {...p}><polyline points="6 9 12 15 18 9"/></IconSVG>,
            ExternalLink: (p) => <IconSVG {...p}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></IconSVG>,
            FileText: (p) => <IconSVG {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></IconSVG>,
            ArrowLeft: (p) => <IconSVG {...p}><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></IconSVG>,
            Image: (p) => <IconSVG {...p}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></IconSVG>,
            Edit: (p) => <IconSVG {...p}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></IconSVG>,
            Mail: (p) => <IconSVG {...p}><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></IconSVG>
        };
        const Icon = ({ name, size = 24, className, onClick }) => {
            const Cmp = Icons[name];
            return Cmp ? <Cmp size={size} className={className} onClick={onClick} /> : <span>?</span>;
        };

        // --- COMPOSANT TechTags ---
        const TechTags = ({ techString, className = "" }) => { 
            if(!techString) return null; 
            const tags = techString.split(',').map(t => t.trim()).filter(t => t); 
            return (
                <div className={`flex flex-wrap gap-2 ${className}`}>
                    {tags.map((t, i) => (
                        <span key={i} className="text-xs bg-teal-500/10 text-teal-400 px-2 py-1 rounded border border-teal-500/30 flex items-center gap-1">
                            <span className="w-1 h-1 rounded-full bg-teal-500"></span> {t}
                        </span>
                    ))}
                </div>
            ); 
        };

        function App() {
            const ADMIN_EMAIL = "admin@portfolio.com";
            
            // États
            const [activeTab, setActiveTab] = useState('about');
            const [selectedProjectId, setSelectedProjectId] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [showLogin, setShowLogin] = useState(false);
            const [passwordInput, setPasswordInput] = useState('');
            const [isLoggingIn, setIsLoggingIn] = useState(false);
            const [user, setUser] = useState(null);
            
            // Données
            const [categories, setCategories] = useState([]);
            const [skills, setSkills] = useState([]);
            const [projects, setProjects] = useState([]);

            // Formulaires Ajout Projet
            const [newCategory, setNewCategory] = useState('');
            const [newSkill, setNewSkill] = useState({ name: '', level: 'Intermédiaire', categoryId: '', libraries: '' });
            // Modification: pdfUrl est maintenant un champ texte
            const [newProject, setNewProject] = useState({ title: '', description: '', tech: '', link: '', pdfUrl: '' });

            // Formulaire Ajout Section (Détail Projet)
            // Modification: imageUrl devient imageUrlsString (texte avec virgules)
            const [newSection, setNewSection] = useState({ title: '', content: '', imageUrlsString: '' });

            // États pour l'édition de section
            const [editingSectionId, setEditingSectionId] = useState(null);
            const [editSectionData, setEditSectionData] = useState({ title: '', content: '', imageUrlsString: '' });

            // --- AUTH ---
            useEffect(() => {
                if(!auth) return;
                const unsubscribe = auth.onAuthStateChanged((u) => {
                    if (u) {
                        setUser(u); setIsAdmin(u.email === ADMIN_EMAIL);
                    } else {
                        auth.signInAnonymously().catch(console.error);
                        setIsAdmin(false); setUser(null);
                    }
                });
                return () => unsubscribe();
            }, []);

            // --- CHARGEMENT ---
            useEffect(() => {
                if (!db) return;
                const unsubCats = db.collection('categories').orderBy('order', 'asc').onSnapshot(s => {
                    const cats = s.docs.map(d => ({id: d.id, ...d.data()}));
                    setCategories(cats);
                    if(cats.length > 0 && !newSkill.categoryId) setNewSkill(prev => ({...prev, categoryId: cats[0].id}));
                });
                const unsubSkills = db.collection('skills').orderBy('order', 'asc').onSnapshot(s => setSkills(s.docs.map(d => ({id: d.id, ...d.data()}))));
                const unsubProjects = db.collection('projects').orderBy('createdAt', 'desc').onSnapshot(s => setProjects(s.docs.map(d => ({id: d.id, ...d.data()}))));
                return () => { unsubCats(); unsubSkills(); unsubProjects(); };
            }, []);

            // --- ACTIONS GLOBALES ---
            const handleLogin = async (e) => {
                e.preventDefault(); setIsLoggingIn(true);
                try { await auth.signInWithEmailAndPassword(ADMIN_EMAIL, passwordInput); setShowLogin(false); setPasswordInput(''); } 
                catch (error) { alert("Erreur : " + error.code); }
                setIsLoggingIn(false);
            };
            const handleLogout = async () => { if(confirm("Se déconnecter ?")) await auth.signOut(); };

            // --- GESTION CATÉGORIES & SKILLS (Code inchangé) ---
            const handleAddCategory = async (e) => { e.preventDefault(); if(!newCategory.trim()) return; const order = categories.length > 0 ? Math.max(...categories.map(c => c.order || 0)) + 1 : 0; await db.collection('categories').add({ name: newCategory, order }); setNewCategory(''); };
            const handleDeleteCategory = async (id) => { if(confirm("Supprimer ?")) await db.collection('categories').doc(id).delete(); };
            const moveCategory = async (index, direction) => { if ((direction === -1 && index === 0) || (direction === 1 && index === categories.length - 1)) return; const c1 = categories[index]; const c2 = categories[index + direction]; await db.collection('categories').doc(c1.id).update({ order: c2.order }); await db.collection('categories').doc(c2.id).update({ order: c1.order }); };
            const handleAddSkill = async (e) => { e.preventDefault(); if (!db || !newSkill.name) return; const libsArray = newSkill.libraries.split(',').map(l => l.trim()).filter(l => l); let catId = newSkill.categoryId; if(!catId && categories.length > 0) catId = categories[0].id; await db.collection('skills').add({ name: newSkill.name, level: newSkill.level, categoryId: catId, libraries: libsArray, order: Date.now() }); setNewSkill({ ...newSkill, name: '', libraries: '' }); };
            const handleDeleteSkill = async (id) => { if(confirm("Supprimer ?")) await db.collection('skills').doc(id).delete(); };
            const moveSkill = async (skillId, direction, localList) => { const index = localList.findIndex(s => s.id === skillId); if (index === -1 || (direction === -1 && index === 0) || (direction === 1 && index === localList.length - 1)) return; const s1 = localList[index]; const s2 = localList[index + direction]; let o1 = s1.order || 0; let o2 = s2.order || 0; if(o1 === o2) { o1 = index; o2 = index + direction; } await db.collection('skills').doc(s1.id).update({ order: o2 }); await db.collection('skills').doc(s2.id).update({ order: o1 }); };

            // --- GESTION PROJETS (Sans Upload) ---
            const handleAddProject = async (e) => { 
                e.preventDefault(); 
                if (!newProject.title) return; 
                
                try {
                    await db.collection('projects').add({ ...newProject, createdAt: Date.now(), sections: [] }); 
                    setNewProject({ title: '', description: '', tech: '', link: '', pdfUrl: '' }); 
                } catch (error) {
                    alert("Erreur base de données : " + error.message);
                }
            };
            const handleDeleteProject = async (id) => { if(confirm("Supprimer le projet complet ?")) await db.collection('projects').doc(id).delete(); };

            // --- GESTION DÉTAILS PROJET (Multi-images) ---
            const handleAddSection = async (e) => {
                e.preventDefault();
                if (!selectedProjectId || !newSection.content) return;

                // Parsing des images multiples
                const imagesArray = newSection.imageUrlsString 
                    ? newSection.imageUrlsString.split(',').map(url => url.trim()).filter(url => url !== "")
                    : [];

                try {
                    const projectRef = db.collection('projects').doc(selectedProjectId);
                    const projectDoc = await projectRef.get();
                    const currentSections = projectDoc.data().sections || [];
                    
                    await projectRef.update({
                        sections: [...currentSections, {
                            id: Date.now(),
                            title: newSection.title,
                            content: newSection.content,
                            imageUrls: imagesArray, // On stocke un tableau
                            imageUrl: imagesArray.length > 0 ? imagesArray[0] : "" // Fallback pour compatibilité
                        }]
                    });

                    setNewSection({ title: '', content: '', imageUrlsString: '' });
                } catch (error) {
                    alert("Erreur sauvegarde section : " + error.message);
                }
            };

            // Gestion édition
            const startEditingSection = (section) => {
                setEditingSectionId(section.id);
                // Convertir le tableau d'images en string pour l'input
                let imgString = "";
                if (section.imageUrls && Array.isArray(section.imageUrls)) {
                    imgString = section.imageUrls.join(', ');
                } else if (section.imageUrl) {
                    imgString = section.imageUrl;
                }
                setEditSectionData({ title: section.title, content: section.content, imageUrlsString: imgString });
            };

            const cancelEditingSection = () => {
                setEditingSectionId(null);
                setEditSectionData({ title: '', content: '', imageUrlsString: '' });
            };

            const handleUpdateSection = async (e) => {
                e.preventDefault();
                if (!selectedProjectId || !editingSectionId) return;
                
                // Parsing des images multiples
                const imagesArray = editSectionData.imageUrlsString 
                    ? editSectionData.imageUrlsString.split(',').map(url => url.trim()).filter(url => url !== "")
                    : [];

                try {
                    const projectRef = db.collection('projects').doc(selectedProjectId);
                    const projectDoc = await projectRef.get();
                    let currentSections = projectDoc.data().sections || [];
                    
                    const oldSectionIndex = currentSections.findIndex(s => s.id === editingSectionId);
                    if (oldSectionIndex === -1) return;
                    
                    currentSections[oldSectionIndex] = {
                        ...currentSections[oldSectionIndex],
                        title: editSectionData.title,
                        content: editSectionData.content,
                        imageUrls: imagesArray,
                        imageUrl: imagesArray.length > 0 ? imagesArray[0] : "" 
                    };

                    await projectRef.update({ sections: currentSections });
                    cancelEditingSection();
                } catch (error) {
                    alert("Erreur mise à jour section : " + error.message);
                }
            };

            const handleDeleteSection = async (sectionId) => {
                if(!confirm("Supprimer cette section ?")) return;
                try {
                    const projectRef = db.collection('projects').doc(selectedProjectId);
                    const projectDoc = await projectRef.get();
                    const currentSections = projectDoc.data().sections || [];
                    const updatedSections = currentSections.filter(s => s.id !== sectionId);
                    await projectRef.update({ sections: updatedSections });
                } catch (error) {
                    alert("Erreur suppression : " + error.message);
                }
            };

            // Helpers
            const getSkillsByCatId = (catId) => skills.filter(s => s.categoryId === catId || (!catId && !s.categoryId)).sort((a,b) => (a.order || 0) - (b.order || 0));

            // --- FORMATAGE TEXTE ---
            const renderFormattedText = (text) => {
                if (!text) return null;
                const parseBold = (str) => {
                    const parts = str.split(/(\*\*.*?\*\*)/g);
                    return parts.map((part, i) => {
                        if (part.startsWith('**') && part.endsWith('**')) {
                            return <strong key={i} className="text-teal-400 font-bold">{part.slice(2, -2)}</strong>;
                        }
                        return part;
                    });
                };
                return text.split('\n').map((line, index) => {
                    const trimmed = line.trim();
                    if (trimmed.startsWith('-') || trimmed.startsWith('•')) {
                        return (
                            <div key={index} className="flex items-start gap-2 mb-1 ml-4">
                                <span className="text-teal-400 font-bold text-lg leading-none mt-0.5">•</span>
                                <span className="flex-1">{parseBold(trimmed.substring(1).trim())}</span>
                            </div>
                        );
                    }
                    if (!trimmed) return <div key={index} className="h-2"></div>;
                    return <p key={index} className="mb-2">{parseBold(line)}</p>;
                });
            };

            // --- AFFICHAGE IMAGES SECTION ---
            const renderSectionImages = (section) => {
                // Compatibilité: On regarde soit le tableau imageUrls, soit le champ unique imageUrl
                const images = (section.imageUrls && section.imageUrls.length > 0) 
                               ? section.imageUrls 
                               : (section.imageUrl ? [section.imageUrl] : []);

                if (images.length === 0) return null;

                // Cas 1: Une seule image (Affichage "Flottant" classique)
                if (images.length === 1) {
                    return (
                        <div className="w-full md:w-1/2 lg:w-2/5 shrink-0">
                            <img src={images[0]} alt="Illustration" className="rounded-lg shadow-lg border border-slate-700 w-full hover:scale-[1.02] transition-transform duration-500 cursor-zoom-in" onClick={() => window.open(images[0], '_blank')} />
                        </div>
                    );
                }

                // Cas 2: Plusieurs images (Affichage Grille en dessous)
                // Note: La fonction renderFormattedText s'occupe du texte, on retourne ici juste les images
                // mais le composant parent doit savoir comment les placer.
                // -> Modifions plutôt la structure d'appel.
                return images; 
            };

            // --- VUE DÉTAIL PROJET ---
            const renderProjectDetail = () => {
                const project = projects.find(p => p.id === selectedProjectId);
                if (!project) return <div>Projet introuvable</div>;

                return (
                    <div className="animate-fade-in">
                        <button onClick={() => setSelectedProjectId(null)} className="mb-6 flex items-center gap-2 text-slate-400 hover:text-white transition-colors">
                            <Icon name="ArrowLeft" size={20} /> Retour aux projets
                        </button>

                        {/* EN-TÊTE PROJET */}
                        <div className="bg-slate-800 rounded-xl border border-slate-700 p-8 mb-8 relative">
                            {isAdmin && <button onClick={() => { handleDeleteProject(project.id); setSelectedProjectId(null); }} className="absolute top-4 right-4 text-red-400 hover:bg-red-900/20 p-2 rounded"><Icon name="Trash2"/></button>}
                            
                            <h1 className="text-3xl md:text-4xl font-bold text-white mb-4">{project.title}</h1>
                            <TechTags techString={project.tech} className="mb-6" />
                            <p className="text-lg text-slate-300 leading-relaxed whitespace-pre-wrap">{project.description}</p>
                            
                            <div className="flex gap-4 mt-6 pt-6 border-t border-slate-700">
                                {project.link && <a href={project.link} target="_blank" className="flex items-center gap-2 text-teal-400 hover:text-teal-300"><Icon name="ExternalLink" size={18}/> Code / Site Web</a>}
                                {project.pdfUrl && <a href={project.pdfUrl} target="_blank" className="flex items-center gap-2 text-red-400 hover:text-red-300"><Icon name="FileText" size={18}/> Rapport PDF</a>}
                            </div>
                        </div>

                        {/* SECTIONS */}
                        <div className="space-y-12">
                            {project.sections && project.sections.map((section, index) => {
                                const images = (section.imageUrls && section.imageUrls.length > 0) ? section.imageUrls : (section.imageUrl ? [section.imageUrl] : []);
                                const isMultiImage = images.length > 1;

                                return (
                                <div key={section.id || index} className="group relative">
                                    {editingSectionId === section.id ? (
                                        <div className="bg-slate-800/90 p-6 rounded-xl border border-blue-500/50 animate-fade-in">
                                            <h3 className="text-blue-400 font-bold mb-4 flex items-center gap-2"><Icon name="Edit"/> Modifier la section</h3>
                                            <form onSubmit={handleUpdateSection} className="space-y-4">
                                                <input className="w-full bg-slate-900 p-3 rounded-lg text-white border border-slate-700 focus:border-blue-500 outline-none" 
                                                    placeholder="Titre" 
                                                    value={editSectionData.title} 
                                                    onChange={e => setEditSectionData({...editSectionData, title: e.target.value})} 
                                                />
                                                <textarea className="w-full bg-slate-900 p-3 rounded-lg text-white border border-slate-700 focus:border-blue-500 outline-none h-40" 
                                                    placeholder="Contenu..." 
                                                    value={editSectionData.content} 
                                                    onChange={e => setEditSectionData({...editSectionData, content: e.target.value})} 
                                                    required 
                                                />
                                                <div className="flex items-center gap-4">
                                                    <div className="flex-1">
                                                        <label className="text-xs text-slate-400 mb-1 block">Liens des images (séparés par des virgules) :</label>
                                                        <input className="w-full bg-slate-900 p-2 rounded text-white border border-slate-700" 
                                                            placeholder="assets/img1.png, assets/img2.png"
                                                            value={editSectionData.imageUrlsString} 
                                                            onChange={e => setEditSectionData({...editSectionData, imageUrlsString: e.target.value})} 
                                                        />
                                                    </div>
                                                    <button type="button" onClick={cancelEditingSection} className="text-slate-400 hover:text-white px-4 font-bold">Annuler</button>
                                                    <button className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition-colors">Enregistrer</button>
                                                </div>
                                            </form>
                                        </div>
                                    ) : (
                                        <>
                                            {isAdmin && (
                                                <div className="absolute -top-3 right-0 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                                    <button onClick={() => startEditingSection(section)} className="bg-slate-900 text-slate-500 hover:text-blue-400 border border-slate-700 p-1 rounded-full" title="Modifier">
                                                        <Icon name="Edit" size={14} />
                                                    </button>
                                                    <button onClick={() => handleDeleteSection(section.id)} className="bg-slate-900 text-slate-500 hover:text-red-400 border border-slate-700 p-1 rounded-full" title="Supprimer">
                                                        <Icon name="Trash2" size={14} />
                                                    </button>
                                                </div>
                                            )}
                                            {section.title && <h2 className="text-2xl font-bold text-teal-400 mb-4 flex items-center gap-3"><span className="text-slate-600">#{index + 1}</span> {section.title}</h2>}
                                            
                                            {/* Layout différent selon le nombre d'images */}
                                            <div className={`flex flex-col gap-8 ${!isMultiImage ? 'md:flex-row items-start' : ''}`}>
                                                <div className={`flex-1 text-slate-300 leading-7 ${images.length === 0 ? 'w-full' : ''}`}>
                                                    {renderFormattedText(section.content)}
                                                </div>
                                                
                                                {images.length === 1 && (
                                                    <div className="w-full md:w-1/2 lg:w-2/5 shrink-0">
                                                        <img src={images[0]} alt="Illustration" className="rounded-lg shadow-lg border border-slate-700 w-full hover:scale-[1.02] transition-transform duration-500 cursor-zoom-in" onClick={() => window.open(images[0], '_blank')} />
                                                    </div>
                                                )}
                                                
                                                {/* Grille si plusieurs images */}
                                                {isMultiImage && (
                                                    <div className="w-full grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-2">
                                                        {images.map((imgUrl, idx) => (
                                                            <div key={idx} className="relative aspect-video rounded-lg overflow-hidden border border-slate-700 shadow-lg group-image">
                                                                <img src={imgUrl} alt={`Illustration ${idx}`} className="w-full h-full object-cover hover:scale-110 transition-transform duration-500 cursor-zoom-in" onClick={() => window.open(imgUrl, '_blank')} />
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                            {index < project.sections.length - 1 && <div className="w-24 h-1 bg-slate-800 rounded-full mx-auto mt-12"></div>}
                                        </>
                                    )}
                                </div>
                            )})}
                        </div>

                        {isAdmin && !editingSectionId && (
                            <div className="mt-16 bg-slate-800/50 p-6 rounded-xl border border-dashed border-teal-500/30">
                                <h3 className="text-teal-400 font-bold mb-4 flex items-center gap-2"><Icon name="Plus"/> Ajouter une Section</h3>
                                <form onSubmit={handleAddSection} className="space-y-4">
                                    <input className="w-full bg-slate-900 p-3 rounded-lg text-white border border-slate-700 focus:border-teal-500 outline-none" placeholder="Titre de la section" value={newSection.title} onChange={e => setNewSection({...newSection, title: e.target.value})} />
                                    <textarea className="w-full bg-slate-900 p-3 rounded-lg text-white border border-slate-700 focus:border-teal-500 outline-none h-40" placeholder="Contenu..." value={newSection.content} onChange={e => setNewSection({...newSection, content: e.target.value})} required />
                                    
                                    <div className="flex items-center gap-4">
                                        <div className="flex-1">
                                            <label className="text-xs text-slate-400 mb-1 block">Liens des images (séparés par des virgules) :</label>
                                            <input className="w-full bg-slate-900 p-2 rounded text-white border border-slate-700" placeholder="assets/img1.png, assets/img2.png" value={newSection.imageUrlsString} onChange={e => setNewSection({...newSection, imageUrlsString: e.target.value})} />
                                        </div>
                                        <button className="bg-teal-500 hover:bg-teal-600 text-white px-6 py-3 rounded-lg font-bold transition-colors h-full">
                                            Ajouter la section
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}
                        
                        <div className="h-20"></div>
                    </div>
                );
            };


            return (
                <div className="min-h-screen bg-slate-900 text-slate-200 font-sans pb-20">
                    <nav className="sticky top-0 z-50 bg-slate-900/90 backdrop-blur-md border-b border-slate-800">
                        <div className="max-w-5xl mx-auto px-4">
                            <div className="flex items-center justify-between h-16">
                                <div className="font-bold text-2xl text-teal-400 cursor-pointer" onClick={() => {setActiveTab('about'); setSelectedProjectId(null);}}>Portfolio<span className="text-white">.</span></div>
                                
                                {!selectedProjectId && (
                                    <div className="flex space-x-2">
                                        {['about', 'skills', 'projects'].map((tab) => (
                                            <button key={tab} onClick={() => setActiveTab(tab)}
                                                className={`px-3 py-2 rounded-md text-sm font-medium transition-all ${activeTab === tab ? 'text-teal-400 bg-teal-500/10' : 'text-slate-400 hover:text-white'}`}>
                                                {tab === 'about' ? 'À propos' : tab === 'skills' ? 'Compétences' : 'Projets'}
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </nav>

                    <main className="max-w-5xl mx-auto px-4 py-12">
                        {selectedProjectId ? renderProjectDetail() : (
                            <>
                                {activeTab === 'about' && (
                                    <div className="animate-fade-in flex flex-col md:flex-row items-center gap-8">
                                        <div className="w-32 h-32 rounded-full bg-slate-800 flex items-center justify-center border-2 border-teal-500 shadow-[0_0_20px_rgba(20,184,166,0.3)]">
                                            <Icon name="User" size={48} className="text-teal-400" />
                                        </div>
                                        <div className="text-center md:text-left">
                                            <h1 className="text-4xl font-bold text-white mb-2">Furkan Arslan</h1>
                                            <h2 className="text-xl text-teal-400 font-semibold mb-4">Étudiant Science des Données</h2>
                                            <p className="text-slate-400 max-w-xl text-lg leading-relaxed mb-6">
                                                Actuellement en 2ème année de BUT SD. J'analyse, modélise et valorise les données pour aider à la prise de décision.
                                            </p>
                                            <div className="flex justify-center md:justify-start gap-4">
                                                <a href="mailto:fu.arslan26@gmail.com" className="flex items-center gap-2 text-slate-300 hover:text-teal-400 transition-colors bg-slate-800 px-4 py-2 rounded-full border border-slate-700">
                                                    <Icon name="Mail" size={18} />
                                                    <span>fu.arslan26@gmail.com</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'skills' && (
                                    <div className="animate-fade-in">
                                        <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-2"><Icon name="Database" /> Mes Compétences</h2>
                                        
                                        {isAdmin && (
                                            <div className="space-y-6 mb-12">
                                                <div className="bg-slate-800/80 p-4 rounded border border-blue-500/30">
                                                    <h3 className="text-blue-400 font-bold mb-3 text-sm uppercase">1. Créer une Catégorie</h3>
                                                    <form onSubmit={handleAddCategory} className="flex gap-2">
                                                        <input className="bg-slate-900 px-3 py-2 rounded text-white border border-slate-700 flex-1" placeholder="Nouvelle catégorie" value={newCategory} onChange={e => setNewCategory(e.target.value)} />
                                                        <button className="bg-blue-600 hover:bg-blue-700 text-white px-4 rounded font-bold">+</button>
                                                    </form>
                                                </div>
                                                <div className="bg-slate-800/80 p-4 rounded border border-teal-500/30">
                                                    <h3 className="text-teal-400 font-bold mb-3 text-sm uppercase">2. Ajouter une Compétence</h3>
                                                    <form onSubmit={handleAddSkill} className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                                        <select className="bg-slate-900 p-2 rounded text-white border border-slate-700" value={newSkill.categoryId} onChange={e => setNewSkill({...newSkill, categoryId: e.target.value})}>
                                                            {categories.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                                                        </select>
                                                        <input className="bg-slate-900 p-2 rounded text-white border border-slate-700" placeholder="Nom" value={newSkill.name} onChange={e => setNewSkill({...newSkill, name: e.target.value})} />
                                                        <input className="bg-slate-900 p-2 rounded text-white border border-slate-700 md:col-span-2" placeholder="Sous-catégories" value={newSkill.libraries} onChange={e => setNewSkill({...newSkill, libraries: e.target.value})} />
                                                        <select className="bg-slate-900 p-2 rounded text-white border border-slate-700" value={newSkill.level} onChange={e => setNewSkill({...newSkill, level: e.target.value})}>
                                                            <option>Débutant</option><option>Intermédiaire</option><option>Avancé</option><option>Expert</option>
                                                        </select>
                                                        <button type="submit" className="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded font-bold">Ajouter</button>
                                                    </form>
                                                </div>
                                            </div>
                                        )}

                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                                            {categories.map((cat, catIndex) => {
                                                const catSkills = getSkillsByCatId(cat.id);
                                                return (
                                                    <div key={cat.id} className="bg-slate-800/50 rounded-xl border border-slate-700 overflow-hidden">
                                                        <div className="bg-slate-800 px-4 py-3 border-b border-slate-700 flex items-center justify-between group">
                                                            <div className="flex items-center gap-2">
                                                                <h3 className="font-bold text-teal-400 text-lg">{cat.name}</h3>
                                                                <span className="text-xs text-slate-500 bg-slate-900 px-2 py-0.5 rounded-full">{catSkills.length}</span>
                                                            </div>
                                                            {isAdmin && (
                                                                <div className="flex gap-1 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity">
                                                                    <button onClick={() => moveCategory(catIndex, -1)} className="p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-white"><Icon name="ChevronUp" size={16}/></button>
                                                                    <button onClick={() => moveCategory(catIndex, 1)} className="p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-white"><Icon name="ChevronDown" size={16}/></button>
                                                                    <button onClick={() => handleDeleteCategory(cat.id)} className="p-1 hover:bg-red-900/50 rounded text-slate-400 hover:text-red-400 ml-2"><Icon name="Trash2" size={16}/></button>
                                                                </div>
                                                            )}
                                                        </div>
                                                        <div className="p-4 space-y-4">
                                                            {catSkills.map((s) => (
                                                                <div key={s.id} className="relative group bg-slate-900/80 p-3 rounded border border-slate-800 hover:border-teal-500/30 transition-all">
                                                                    <div className="flex justify-between items-start mb-2">
                                                                        <div><span className="font-bold text-slate-100 text-lg block">{s.name}</span><span className={`text-[10px] uppercase tracking-wider font-bold ${s.level === 'Expert' ? 'text-purple-400' : s.level === 'Avancé' ? 'text-teal-400' : s.level === 'Intermédiaire' ? 'text-blue-400' : 'text-slate-500'}`}>{s.level}</span></div>
                                                                        {isAdmin && (<div className="flex gap-1"><div className="flex flex-col mr-2"><button onClick={() => moveSkill(s.id, -1, catSkills)} className="text-slate-600 hover:text-white"><Icon name="ChevronUp" size={14}/></button><button onClick={() => moveSkill(s.id, 1, catSkills)} className="text-slate-600 hover:text-white"><Icon name="ChevronDown" size={14}/></button></div><button onClick={() => handleDeleteSkill(s.id)} className="text-slate-600 hover:text-red-400"><Icon name="Trash2" size={16} /></button></div>)}
                                                                    </div>
                                                                    <TechTags techString={s.libraries ? s.libraries.join(',') : ''} className="mt-2 pt-2 border-t border-slate-800" />
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'projects' && (
                                    <div className="animate-fade-in">
                                        <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-2"><Icon name="Briefcase" /> Projets Réalisés</h2>
                                        
                                        {isAdmin && (
                                            <form onSubmit={handleAddProject} className="mb-8 p-6 bg-slate-800 rounded-xl border border-teal-500/30 grid gap-4">
                                                <h3 className="text-teal-400 font-bold mb-2 uppercase text-sm">Nouveau Projet</h3>
                                                <input className="bg-slate-900 p-3 rounded-lg text-white border border-slate-700 focus:border-teal-500 outline-none" placeholder="Titre" value={newProject.title} onChange={e => setNewProject({...newProject, title: e.target.value})} />
                                                <textarea className="bg-slate-900 p-3 rounded-lg text-white border border-slate-700 focus:border-teal-500 outline-none h-24" placeholder="Description courte..." value={newProject.description} onChange={e => setNewProject({...newProject, description: e.target.value})} />
                                                <div><label className="text-xs text-slate-400 mb-1 block">Technologies :</label><input className="w-full bg-slate-900 p-3 rounded-lg text-white border border-slate-700 focus:border-teal-500 outline-none" placeholder="ex: Python, Pandas" value={newProject.tech} onChange={e => setNewProject({...newProject, tech: e.target.value})} />{newProject.tech && <div className="mt-2"><TechTags techString={newProject.tech} /></div>}</div>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div><label className="text-xs text-slate-400 mb-1 block">Lien GitHub/Web :</label><input className="w-full bg-slate-900 p-3 rounded-lg text-white border border-slate-700 focus:border-teal-500 outline-none" value={newProject.link} onChange={e => setNewProject({...newProject, link: e.target.value})} /></div>
                                                    <div><label className="text-xs text-slate-400 mb-1 block">Lien PDF (assets/mon-cv.pdf) :</label><input className="w-full bg-slate-900 p-3 rounded-lg text-white border border-slate-700 focus:border-teal-500 outline-none" value={newProject.pdfUrl} onChange={e => setNewProject({...newProject, pdfUrl: e.target.value})} /></div>
                                                </div>
                                                <button className="bg-teal-500 hover:bg-teal-600 px-6 py-3 rounded-lg text-white font-bold transition-colors">Créer le Projet</button>
                                            </form>
                                        )}

                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                            {projects.map(p => (
                                                <div key={p.id} 
                                                     onClick={() => setSelectedProjectId(p.id)}
                                                     className="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden hover:border-teal-500/50 hover:shadow-xl hover:shadow-teal-900/10 transition-all flex flex-col group cursor-pointer transform hover:-translate-y-1">
                                                    <div className="h-2 bg-gradient-to-r from-teal-500 to-blue-600"></div>
                                                    <div className="p-6 flex-1 flex flex-col relative">
                                                        <h3 className="text-2xl font-bold text-white mb-3 group-hover:text-teal-400 transition-colors">{p.title}</h3>
                                                        <p className="text-slate-400 mb-6 flex-1 leading-relaxed line-clamp-3">{p.description}</p>
                                                        
                                                        <div className="bg-slate-900/50 rounded-lg p-3 border border-slate-700/50 mb-4">
                                                            <div className="flex items-center gap-2 mb-2 text-xs font-semibold text-slate-500 uppercase tracking-wider"><Icon name="Code" size={14} /> Technologies</div>
                                                            <TechTags techString={p.tech} />
                                                        </div>
                                                        <div className="text-teal-400 text-sm font-bold flex items-center gap-1 mt-auto">
                                                            Voir le détail <Icon name="ArrowLeft" className="rotate-180" size={16}/>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </>
                        )}
                    </main>

                    <footer className="fixed bottom-0 w-full bg-slate-900 border-t border-slate-800 p-4 flex justify-between text-slate-500 text-sm z-50">
                        <span>© 2025 Portfolio</span>
                        <button onClick={() => isAdmin ? handleLogout() : setShowLogin(!showLogin)}>
                            {isAdmin ? <span className="text-teal-400 flex gap-2 items-center"><Icon name="Unlock" size={16} /> Admin</span> : <Icon name="Lock" size={16} />}
                        </button>
                    </footer>

                    {showLogin && !isAdmin && (
                        <div className="fixed bottom-12 right-4 bg-slate-800 p-4 rounded-xl shadow-2xl border border-slate-700 z-50 animate-fade-in">
                             <div className="flex justify-between items-center mb-4"><span className="text-xs font-bold text-white uppercase tracking-wider">Accès Admin</span><button onClick={() => setShowLogin(false)}><Icon name="X" size={14} /></button></div>
                             <form onSubmit={handleLogin} className="flex gap-2">
                                <input type="password" placeholder="Mot de passe" value={passwordInput} onChange={e => setPasswordInput(e.target.value)} className="bg-slate-900 text-white p-2 rounded-lg border border-slate-600 focus:border-teal-500 outline-none w-48" />
                                <button disabled={isLoggingIn} className="bg-teal-500 hover:bg-teal-600 text-white font-bold px-4 rounded-lg transition-colors">{isLoggingIn ? '...' : 'OK'}</button>
                             </form>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>